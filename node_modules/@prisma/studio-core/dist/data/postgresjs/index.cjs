"use strict";var c=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var k=(e,r)=>()=>(e&&(r=e(e=0)),r);var q=(e,r)=>{for(var n in r)c(e,n,{get:r[n],enumerable:!0})},h=(e,r,n,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of T(r))!P.call(e,o)&&o!==n&&c(e,o,{get:()=>r[o],enumerable:!(t=Q(r,o))||t.enumerable});return e};var C=e=>h(c({},"__esModule",{value:!0}),e);var u=k(()=>{});var B={};q(B,{createPostgresJSExecutor:()=>A});module.exports=C(B);u();u();var p=class extends Error{constructor(){super("This operation was aborted"),this.name="AbortError"}};function i(){return[new p]}u();u();function g(e){return typeof e=="string"?{parameters:[],sql:e}:e}function b(){return g("select pg_backend_pid() as pid")}function v(e){return{parameters:[e],sql:"select pg_cancel_backend($1);"}}function A(e){return{execute:async(r,n)=>{let{abortSignal:t}=n||{};if(!t)try{return[null,await e.unsafe(r.sql,r.parameters)]}catch(a){return[a]}if(t.aborted)return i();let o,s;try{let a,l=new Promise(E=>a=E);t.addEventListener("abort",o=()=>a());let m=e.reserve(),d=await Promise.race([m,l]);if(!d)return m.catch(()=>{}),i();if(s=d,t.aborted)return s.release(),i();let f=F(s),x=await Promise.race([f,l]);if(x===void 0)return f.catch(()=>{}).finally(()=>s?.release()),i();if(t.aborted)return s.release(),i();let w=s.unsafe(r.sql,r.parameters),R=await Promise.race([w,l]);return R?(s.release(),[null,R]):(Promise.allSettled([O(e,x),w]).finally(()=>s?.release()),i())}catch(a){return s?.release(),[a]}finally{o&&t?.removeEventListener("abort",o)}}}}async function O(e,r){let n=v(r);try{await e.unsafe(n.sql,n.parameters)}catch(t){console.error("Failed to cancel query:",t)}}async function F(e){let r=b();try{let[n]=await e.unsafe(r.sql,r.parameters);return n?.pid}catch(n){console.error("Failed to get connection PID:",n);return}}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiPGRlZmluZTpBQ0NFTEVSQVRFX1NDSEVNQV9CWV9QUk9WSURFUj4iLCAiLi4vLi4vLi4vZGF0YS9wb3N0Z3Jlc2pzL2luZGV4LnRzIiwgIi4uLy4uLy4uL2RhdGEvZXhlY3V0b3IudHMiLCAiLi4vLi4vLi4vZGF0YS9wb3N0Z3Jlcy1jb3JlL3V0aWxpdHkudHMiLCAiLi4vLi4vLi4vZGF0YS9xdWVyeS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiIiwgImltcG9ydCB0eXBlIHsgUmVzZXJ2ZWRTcWwsIFNxbCB9IGZyb20gXCJwb3N0Z3Jlc1wiO1xuXG5pbXBvcnQgeyB0eXBlIEV4ZWN1dG9yLCBnZXRBYm9ydFJlc3VsdCB9IGZyb20gXCIuLi9leGVjdXRvclwiO1xuaW1wb3J0IHsgZ2V0Q2FuY2VsUXVlcnksIGdldFBJRFF1ZXJ5IH0gZnJvbSBcIi4uL3Bvc3RncmVzLWNvcmUvdXRpbGl0eVwiO1xuaW1wb3J0IHR5cGUgeyBRdWVyeVJlc3VsdCB9IGZyb20gXCIuLi9xdWVyeVwiO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUG9zdGdyZXNKU0V4ZWN1dG9yKHBvc3RncmVzanM6IFNxbCk6IEV4ZWN1dG9yIHtcbiAgcmV0dXJuIHtcbiAgICBleGVjdXRlOiBhc3luYyAocXVlcnksIG9wdGlvbnMpID0+IHtcbiAgICAgIGNvbnN0IHsgYWJvcnRTaWduYWwgfSA9IG9wdGlvbnMgfHwge307XG5cbiAgICAgIGlmICghYWJvcnRTaWduYWwpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb3N0Z3Jlc2pzLnVuc2FmZShxdWVyeS5zcWwsIHF1ZXJ5LnBhcmFtZXRlcnMgYXMgbmV2ZXIpO1xuXG4gICAgICAgICAgcmV0dXJuIFtudWxsLCByZXN1bHQgYXMgbmV2ZXJdO1xuICAgICAgICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikge1xuICAgICAgICAgIHJldHVybiBbZXJyb3IgYXMgRXJyb3JdO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChhYm9ydFNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgIHJldHVybiBnZXRBYm9ydFJlc3VsdCgpO1xuICAgICAgfVxuXG4gICAgICBsZXQgYWJvcnRMaXN0ZW5lcjogKCgpID0+IHZvaWQpIHwgdW5kZWZpbmVkO1xuICAgICAgbGV0IGNvbm5lY3Rpb246IFJlc2VydmVkU3FsIHwgdW5kZWZpbmVkO1xuXG4gICAgICB0cnkge1xuICAgICAgICBsZXQgYWJvcnRlZDogKCkgPT4gdm9pZDtcbiAgICAgICAgY29uc3QgYWJvcnRpb25Qcm9taXNlID0gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUpID0+IChhYm9ydGVkID0gcmVzb2x2ZSkpO1xuXG4gICAgICAgIGFib3J0U2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoXCJhYm9ydFwiLCAoYWJvcnRMaXN0ZW5lciA9ICgpID0+IGFib3J0ZWQoKSkpO1xuXG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb25Qcm9taXNlID0gcG9zdGdyZXNqcy5yZXNlcnZlKCk7XG5cbiAgICAgICAgY29uc3QgY29ubmVjdGlvblJlc3VsdCA9IGF3YWl0IFByb21pc2UucmFjZShbY29ubmVjdGlvblByb21pc2UsIGFib3J0aW9uUHJvbWlzZV0pO1xuXG4gICAgICAgIGlmICghY29ubmVjdGlvblJlc3VsdCkge1xuICAgICAgICAgIHZvaWQgY29ubmVjdGlvblByb21pc2UuY2F0Y2goKCkgPT4ge30pO1xuXG4gICAgICAgICAgcmV0dXJuIGdldEFib3J0UmVzdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25uZWN0aW9uID0gY29ubmVjdGlvblJlc3VsdDtcblxuICAgICAgICBpZiAoYWJvcnRTaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuXG4gICAgICAgICAgcmV0dXJuIGdldEFib3J0UmVzdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwaWRQcm9taXNlID0gZ2V0Q29ubmVjdGlvblBJRChjb25uZWN0aW9uKTtcblxuICAgICAgICBjb25zdCBwaWRSZXN1bHQgPSBhd2FpdCBQcm9taXNlLnJhY2UoW3BpZFByb21pc2UsIGFib3J0aW9uUHJvbWlzZV0pO1xuXG4gICAgICAgIGlmIChwaWRSZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHZvaWQgcGlkUHJvbWlzZS5jYXRjaCgoKSA9PiB7fSkuZmluYWxseSgoKSA9PiBjb25uZWN0aW9uPy5yZWxlYXNlKCkpO1xuXG4gICAgICAgICAgcmV0dXJuIGdldEFib3J0UmVzdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWJvcnRTaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuXG4gICAgICAgICAgcmV0dXJuIGdldEFib3J0UmVzdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBxdWVyeVByb21pc2UgPSBjb25uZWN0aW9uLnVuc2FmZShxdWVyeS5zcWwsIHF1ZXJ5LnBhcmFtZXRlcnMgYXMgbmV2ZXIpO1xuXG4gICAgICAgIGNvbnN0IHF1ZXJ5UmVzdWx0ID0gYXdhaXQgUHJvbWlzZS5yYWNlKFtxdWVyeVByb21pc2UsIGFib3J0aW9uUHJvbWlzZV0pO1xuXG4gICAgICAgIGlmICghcXVlcnlSZXN1bHQpIHtcbiAgICAgICAgICB2b2lkIFByb21pc2UuYWxsU2V0dGxlZChbY2FuY2VsUXVlcnkocG9zdGdyZXNqcywgcGlkUmVzdWx0ISksIHF1ZXJ5UHJvbWlzZV0pLmZpbmFsbHkoKCkgPT5cbiAgICAgICAgICAgIGNvbm5lY3Rpb24/LnJlbGVhc2UoKSxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgcmV0dXJuIGdldEFib3J0UmVzdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25uZWN0aW9uLnJlbGVhc2UoKTtcblxuICAgICAgICByZXR1cm4gW251bGwsIHF1ZXJ5UmVzdWx0IGFzIG5ldmVyXTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiB1bmtub3duKSB7XG4gICAgICAgIGNvbm5lY3Rpb24/LnJlbGVhc2UoKTtcblxuICAgICAgICByZXR1cm4gW2Vycm9yIGFzIEVycm9yXTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGlmIChhYm9ydExpc3RlbmVyKSB7XG4gICAgICAgICAgYWJvcnRTaWduYWw/LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhYm9ydFwiLCBhYm9ydExpc3RlbmVyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gIH07XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZW1wdHktb2JqZWN0LXR5cGVcbmFzeW5jIGZ1bmN0aW9uIGNhbmNlbFF1ZXJ5KHBvc3RncmVzanM6IFNxbCwgcGlkOiB7fSk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBxdWVyeSA9IGdldENhbmNlbFF1ZXJ5KHBpZCk7XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBwb3N0Z3Jlc2pzLnVuc2FmZShxdWVyeS5zcWwsIHF1ZXJ5LnBhcmFtZXRlcnMgYXMgbmV2ZXIpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY2FuY2VsIHF1ZXJ5OlwiLCBlcnJvcik7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q29ubmVjdGlvblBJRChjb25uZWN0aW9uOiBSZXNlcnZlZFNxbCk6IFByb21pc2U8dW5rbm93bj4ge1xuICBjb25zdCBxdWVyeSA9IGdldFBJRFF1ZXJ5KCk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBbcmVzdWx0XSA9IGF3YWl0IGNvbm5lY3Rpb24udW5zYWZlPFF1ZXJ5UmVzdWx0PHR5cGVvZiBxdWVyeT4+KHF1ZXJ5LnNxbCwgcXVlcnkucGFyYW1ldGVycyBhcyBuZXZlcik7XG5cbiAgICByZXR1cm4gcmVzdWx0Py5waWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgY29ubmVjdGlvbiBQSUQ6XCIsIGVycm9yKTtcblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbn1cbiIsICJpbXBvcnQgdHlwZSB7IFF1ZXJ5LCBRdWVyeVJlc3VsdCB9IGZyb20gXCIuL3F1ZXJ5XCI7XG5pbXBvcnQgdHlwZSB7IEVpdGhlciB9IGZyb20gXCIuL3R5cGUtdXRpbHNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBFeGVjdXRvciB7XG4gIGV4ZWN1dGU8VD4ocXVlcnk6IFF1ZXJ5PFQ+LCBvcHRpb25zPzogRXhlY3V0ZU9wdGlvbnMpOiBQcm9taXNlPEVpdGhlcjxFcnJvciwgUXVlcnlSZXN1bHQ8UXVlcnk8VD4+Pj47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VxdWVuY2VFeGVjdXRvciBleHRlbmRzIEV4ZWN1dG9yIHtcbiAgZXhlY3V0ZVNlcXVlbmNlPFQsIFM+KFxuICAgIHNlcXVlbmNlOiByZWFkb25seSBbUXVlcnk8VD4sIFF1ZXJ5PFM+XSxcbiAgICBvcHRpb25zPzogRXhlY3V0ZU9wdGlvbnMsXG4gICk6IFByb21pc2U8W1tFcnJvcl1dIHwgW1tudWxsLCBRdWVyeVJlc3VsdDxRdWVyeTxUPj5dLCBFaXRoZXI8RXJyb3IsIFF1ZXJ5UmVzdWx0PFF1ZXJ5PFM+Pj5dPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFeGVjdXRlT3B0aW9ucyB7XG4gIGFib3J0U2lnbmFsPzogQWJvcnRTaWduYWw7XG59XG5cbmV4cG9ydCBjbGFzcyBBYm9ydEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcihcIlRoaXMgb3BlcmF0aW9uIHdhcyBhYm9ydGVkXCIpO1xuICAgIHRoaXMubmFtZSA9IFwiQWJvcnRFcnJvclwiO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBYm9ydFJlc3VsdCgpOiBbQWJvcnRFcnJvcl0ge1xuICByZXR1cm4gW25ldyBBYm9ydEVycm9yKCldO1xufVxuIiwgImltcG9ydCB7IGFzUXVlcnksIHR5cGUgUXVlcnkgfSBmcm9tIFwiLi4vcXVlcnlcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFBJRFF1ZXJ5KCk6IFF1ZXJ5PHsgcGlkOiB1bmtub3duIH0+IHtcbiAgcmV0dXJuIGFzUXVlcnkoXCJzZWxlY3QgcGdfYmFja2VuZF9waWQoKSBhcyBwaWRcIik7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZW1wdHktb2JqZWN0LXR5cGVcbmV4cG9ydCBmdW5jdGlvbiBnZXRDYW5jZWxRdWVyeShwaWQ6IHt9KTogUXVlcnk8dW5rbm93bj4ge1xuICByZXR1cm4ge1xuICAgIHBhcmFtZXRlcnM6IFtwaWRdLFxuICAgIHNxbDogXCJzZWxlY3QgcGdfY2FuY2VsX2JhY2tlbmQoJDEpO1wiLFxuICB9O1xufVxuIiwgImltcG9ydCB7XG4gIHR5cGUgQ29tcGlsYWJsZSxcbiAgdHlwZSBEaWFsZWN0QWRhcHRlcixcbiAgRHVtbXlEcml2ZXIsXG4gIHR5cGUgRXhwcmVzc2lvbixcbiAgdHlwZSBFeHByZXNzaW9uQnVpbGRlcixcbiAgZXhwcmVzc2lvbkJ1aWxkZXIsXG4gIHR5cGUgRXhwcmVzc2lvbldyYXBwZXIsXG4gIHR5cGUgSW5zZXJ0T2JqZWN0LFxuICBLeXNlbHksXG4gIHR5cGUgS3lzZWx5UGx1Z2luLFxuICBPcGVyYXRpb25Ob2RlVHJhbnNmb3JtZXIsXG4gIHR5cGUgUGx1Z2luVHJhbnNmb3JtUXVlcnlBcmdzLFxuICB0eXBlIFBsdWdpblRyYW5zZm9ybVJlc3VsdEFyZ3MsXG4gIHR5cGUgUHJpbWl0aXZlVmFsdWVMaXN0Tm9kZSxcbiAgdHlwZSBRdWVyeUNvbXBpbGVyLFxuICB0eXBlIFF1ZXJ5UmVzdWx0IGFzIEt5c2VseVF1ZXJ5UmVzdWx0LFxuICB0eXBlIFJvb3RPcGVyYXRpb25Ob2RlLFxuICBzcWwsXG4gIHR5cGUgU3FsQm9vbCxcbiAgdHlwZSBVbmtub3duUm93LFxuICB0eXBlIFVwZGF0ZU9iamVjdCxcbiAgVmFsdWVMaXN0Tm9kZSxcbiAgVmFsdWVOb2RlLFxuICB0eXBlIFdoZXJlSW50ZXJmYWNlLFxufSBmcm9tIFwia3lzZWx5XCI7XG5cbmltcG9ydCB0eXBlIHsgQ29sdW1uLCBDb2x1bW5GaWx0ZXIsIEZpbHRlckdyb3VwLCBUYWJsZSB9IGZyb20gXCIuL2FkYXB0ZXJcIjtcbmltcG9ydCB7IERFRkFVTFRfQk9PTEVBTiwgREVGQVVMVF9KU09OLCBERUZBVUxUX05VTUVSSUMsIERFRkFVTFRfU1RSSU5HLCBnZXREYXRlMCB9IGZyb20gXCIuL2RlZmF1bHRzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVpbGRlclJlcXVpcmVtZW50cyB7XG4gIEFkYXB0ZXI6IHsgbmV3ICgpOiBEaWFsZWN0QWRhcHRlciB9O1xuICBub1BhcmFtZXRlcnM/OiBib29sZWFuO1xuICBRdWVyeUNvbXBpbGVyOiB7IG5ldyAoKTogUXVlcnlDb21waWxlciB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QnVpbGRlcjxEQj4ocmVxdWlyZW1lbnRzOiBCdWlsZGVyUmVxdWlyZW1lbnRzKTogS3lzZWx5PERCPiB7XG4gIHJldHVybiBuZXcgS3lzZWx5KHtcbiAgICBkaWFsZWN0OiB7XG4gICAgICBjcmVhdGVBZGFwdGVyOiAoKSA9PiBuZXcgcmVxdWlyZW1lbnRzLkFkYXB0ZXIoKSxcbiAgICAgIGNyZWF0ZURyaXZlcjogKCkgPT4gbmV3IER1bW15RHJpdmVyKCksXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gd2UgZG9uJ3QgbmVlZCBidWlsdC1pbiBpbnRyb3NwZWN0aW9uIGluIHRoaXMgY2FzZVxuICAgICAgY3JlYXRlSW50cm9zcGVjdG9yOiAoKSA9PiBudWxsLFxuICAgICAgY3JlYXRlUXVlcnlDb21waWxlcjogKCkgPT4gbmV3IHJlcXVpcmVtZW50cy5RdWVyeUNvbXBpbGVyKCksXG4gICAgfSxcbiAgICBwbHVnaW5zOiBbLi4uKHJlcXVpcmVtZW50cy5ub1BhcmFtZXRlcnMgPyBbbmV3IEltbWVkaWF0ZVZhbHVlUGx1Z2luKCldIDogW10pXSxcbiAgfSk7XG59XG5cbi8qKlxuICogQSBwbHVnaW4gdGhhdCB0cmFuc2Zvcm1zIGFsbCB2YWx1ZXMgdG8gaW1tZWRpYXRlIHZhbHVlcy4gVGhpcyBtZWFucyB0aGVpciBpbmplY3RlZCBpbnRvIHRoZSBTUUwgc3RyaW5nIGluc3RlYWQgb2YgcG9wdWxhdGluZyB0aGUgcGFyYW1ldGVycyBhcnJheS5cbiAqIEluIHNvbWUgc2l0dWF0aW9ucywgYSBkYXRhYmFzZSBkcml2ZXIgbWlnaHQgbm90IHN1cHBvcnQgcGFyYW1ldGVycywgYW5kIHRoaXMgcGx1Z2luIGNhbiBiZSB1c2VkIHRvIHdvcmsgYXJvdW5kIHRoYXQuXG4gKi9cbmNsYXNzIEltbWVkaWF0ZVZhbHVlUGx1Z2luIGltcGxlbWVudHMgS3lzZWx5UGx1Z2luIHtcbiAgcmVhZG9ubHkgI3RyYW5zZm9ybWVyID0gbmV3IEltbWVkaWF0ZVZhbHVlVHJhbnNmb3JtZXIoKTtcblxuICB0cmFuc2Zvcm1RdWVyeShhcmdzOiBQbHVnaW5UcmFuc2Zvcm1RdWVyeUFyZ3MpOiBSb290T3BlcmF0aW9uTm9kZSB7XG4gICAgcmV0dXJuIHRoaXMuI3RyYW5zZm9ybWVyLnRyYW5zZm9ybU5vZGUoYXJncy5ub2RlKTtcbiAgfVxuXG4gIHRyYW5zZm9ybVJlc3VsdChhcmdzOiBQbHVnaW5UcmFuc2Zvcm1SZXN1bHRBcmdzKTogUHJvbWlzZTxLeXNlbHlRdWVyeVJlc3VsdDxVbmtub3duUm93Pj4ge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoYXJncy5yZXN1bHQpO1xuICB9XG59XG5cbmNsYXNzIEltbWVkaWF0ZVZhbHVlVHJhbnNmb3JtZXIgZXh0ZW5kcyBPcGVyYXRpb25Ob2RlVHJhbnNmb3JtZXIge1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgdHJhbnNmb3JtUHJpbWl0aXZlVmFsdWVMaXN0KG5vZGU6IFByaW1pdGl2ZVZhbHVlTGlzdE5vZGUpOiBQcmltaXRpdmVWYWx1ZUxpc3ROb2RlIHtcbiAgICByZXR1cm4gVmFsdWVMaXN0Tm9kZS5jcmVhdGUobm9kZS52YWx1ZXMubWFwKFZhbHVlTm9kZS5jcmVhdGVJbW1lZGlhdGUpKSBhcyBuZXZlcjtcbiAgfVxuXG4gIG92ZXJyaWRlIHRyYW5zZm9ybVZhbHVlKG5vZGU6IFZhbHVlTm9kZSk6IFZhbHVlTm9kZSB7XG4gICAgcmV0dXJuIHsgLi4uc3VwZXIudHJhbnNmb3JtVmFsdWUobm9kZSksIGltbWVkaWF0ZTogdHJ1ZSB9O1xuICB9XG59XG5cbmRlY2xhcmUgY29uc3QgcXVlcnlUeXBlOiB1bmlxdWUgc3ltYm9sO1xuZXhwb3J0IGludGVyZmFjZSBRdWVyeTxUID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgW3F1ZXJ5VHlwZV0/OiBUO1xuICBwYXJhbWV0ZXJzOiByZWFkb25seSB1bmtub3duW107XG4gIHNxbDogc3RyaW5nO1xuICB0cmFuc2Zvcm1hdGlvbnM/OiBQYXJ0aWFsPFJlY29yZDxrZXlvZiBULCBcImpzb24tcGFyc2VcIj4+O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNRdWVyeTxUPihxdWVyeTogc3RyaW5nIHwgUXVlcnk8dW5rbm93bj4pOiBRdWVyeTxUPiB7XG4gIGlmICh0eXBlb2YgcXVlcnkgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4geyBwYXJhbWV0ZXJzOiBbXSwgc3FsOiBxdWVyeSB9IGFzIG5ldmVyO1xuICB9XG5cbiAgcmV0dXJuIHF1ZXJ5IGFzIG5ldmVyO1xufVxuXG5leHBvcnQgdHlwZSBRdWVyeVJlc3VsdDxUPiA9XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIFQgZXh0ZW5kcyBRdWVyeTxpbmZlciBSPiA/IFJbXSA6IFQgZXh0ZW5kcyAoLi4uYXJnczogYW55W10pID0+IFF1ZXJ5PGluZmVyIFI+ID8gUltdIDogbmV2ZXI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcGlsZU9wdGlvbnM8VD4ge1xuICAvKipcbiAgICogQSBtYXBwaW5nIG9mIGNvbHVtbiBuYW1lcyB0byB0cmFuc2Zvcm1hdGlvbnMgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byB0aGUgcmVzdWx0LlxuICAgKiBDdXJyZW50bHkgc3VwcG9ydGVkIHRyYW5zZm9ybWF0aW9uIGlzIFwianNvbi1wYXJzZVwiLCB3aGljaCBwYXJzZXMgYSBKU09OIHN0cmluZyBpbnRvIGFuIG9iamVjdC5cbiAgICovXG4gIHRyYW5zZm9ybWF0aW9ucz86IFBhcnRpYWw8UmVjb3JkPGtleW9mIFQsIFwianNvbi1wYXJzZVwiPj47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21waWxlPFQgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4oXG4gIGNvbXBpbGVhYmxlOiBDb21waWxhYmxlPFQ+LFxuICBvcHRpb25zPzogQ29tcGlsZU9wdGlvbnM8VD4sXG4pOiBRdWVyeTxUPiB7XG4gIGNvbnN0IGNvbXBpbGVkUXVlcnkgPSBjb21waWxlYWJsZS5jb21waWxlKCk7XG5cbiAgcmV0dXJuIHtcbiAgICBwYXJhbWV0ZXJzOiBjb21waWxlZFF1ZXJ5LnBhcmFtZXRlcnMsXG4gICAgc3FsOiBjb21waWxlZFF1ZXJ5LnNxbCxcbiAgICB0cmFuc2Zvcm1hdGlvbnM6IG9wdGlvbnM/LnRyYW5zZm9ybWF0aW9ucyxcbiAgfTtcbn1cblxuLyoqXG4gKiBBcHBsaWVzIGEgZmlsdGVyIHRvIHRoZSBnaXZlbiByb3dzIGJhc2VkIG9uIHRoZSBwcmltYXJ5IGtleSBjb2x1bW5zIG9mIHRoZSB0YWJsZS5cbiAqXG4gKiBAZXhhbXBsZSBkYi5zZWxlY3RGcm9tKFwidXNlcnNcIikuJGNhbGwoYXBwbHlJbmZlcnJlZFJvd0ZpbHRlcnMocm93cywgY29sdW1ucykpLnNlbGVjdEFsbCgpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBseUluZmVycmVkUm93RmlsdGVycyhyb3dzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPltdLCBjb2x1bW5zOiBUYWJsZVtcImNvbHVtbnNcIl0pIHtcbiAgY29uc3Qgcm93RmlsdGVycyA9IGluZmVyUm93RmlsdGVycyhyb3dzLCBjb2x1bW5zKTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICByZXR1cm4gPFFCIGV4dGVuZHMgV2hlcmVJbnRlcmZhY2U8YW55LCBhbnk+PihxYjogUUIpOiBRQiA9PlxuICAgIHFiLndoZXJlKChlYikgPT4ge1xuICAgICAgcmV0dXJuIGViLm9yKFxuICAgICAgICByb3dGaWx0ZXJzLm1hcCgocm93RmlsdGVyKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGViLmFuZChcbiAgICAgICAgICAgIHJvd0ZpbHRlci5tYXAoKFtjb2x1bW5OYW1lLCB2YWx1ZV0pID0+XG4gICAgICAgICAgICAgIGViKGNvbHVtbk5hbWUsIHZhbHVlID09PSBudWxsID8gXCJpc1wiIDogQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBcImluXCIgOiBcIj1cIiwgdmFsdWUpLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICApO1xuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSkgYXMgbmV2ZXI7XG59XG5cbi8qKlxuICogUGFydCBvZiBhIGZpbHRlciB0aGF0IHByZWRpY3RzIGEgbWF0Y2guXG4gKiBpZS4gLi4uIFdIRVJFICRDb2x1bU5hbWUgPSAkVmFsdWUgLi4uXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG50eXBlIFJvd0ZpbHRlclByZWRpY2F0ZSA9IFtDb2x1bW5OYW1lOiBzdHJpbmcgfCBFeHByZXNzaW9uPGFueT4sIFZhbHVlOiB1bmtub3duXTtcblxuLyoqXG4gKiBBIHJvdyBmaWx0ZXIgaXMgY29tcHJpc2VkIG9mIG9uZSBvciBtb3JlIHByZWRpY2F0ZXMuXG4gKi9cbnR5cGUgUm93RmlsdGVyID0gUm93RmlsdGVyUHJlZGljYXRlW107XG5cbi8qKlxuICogUm93IGZpbHRlcnMgaXMgc2ltcGx5IGEgc2V0IG9mIG11bHRpcGxlIHtAbGluayBSb3dGaWx0ZXJ9LlxuICovXG50eXBlIFJvd0ZpbHRlcnMgPSBSb3dGaWx0ZXJbXTtcblxuLyoqXG4gKiBJbmZlcnMgdGhlIGZpbHRlciB0aGF0IGlzIG5lY2Vzc2FyeSB0byB1bmlxdWVseSBpZGVudGlmeSBhIGdpdmVuIHJvd1xuICogaW5kaXZpZHVhbGx5LlxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5mZXJGaWx0ZXJPYmplY3Qocm93OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiwgY29sdW1uczogVGFibGVbXCJjb2x1bW5zXCJdKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICBjb25zdCBmaWx0ZXI6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge307XG5cbiAgZm9yIChjb25zdCBjb2x1bW4gb2YgT2JqZWN0LnZhbHVlcyhjb2x1bW5zKSkge1xuICAgIGNvbnN0IHsgbmFtZTogY29sdW1uTmFtZSwgcGtQb3NpdGlvbiB9ID0gY29sdW1uO1xuXG4gICAgaWYgKHBrUG9zaXRpb24gPT0gbnVsbCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgZmlsdGVyW2NvbHVtbk5hbWVdID0gcm93W2NvbHVtbk5hbWVdID8/IG51bGw7XG4gIH1cblxuICByZXR1cm4gZmlsdGVyO1xufVxuXG4vKipcbiAqIEluZmVycyB0aGUgZmlsdGVyIHRoYXQgaXMgbmVjZXNzYXJ5IHRvIHVuaXF1ZWx5IGlkZW50aWZ5IG11bHRpcGxlIHJvd3NcbiAqIGluZGl2aWR1YWxseS5cbiAqXG4gKiBFbGVnYW50bHkgaW5mZXJzIHRoZSBiZXN0IHBvc3NpYmxlIHN0YXRlbWVudCB0byBmaWx0ZXIgd2l0aC5cbiAqIFRPRE86IGlmIHdlIGV2ZXIgc3VwcG9ydCBNU1NRTCwgd2UnbGwgbmVlZCB0byBkcm9wIHRvIGR1bWIgKC4uLiBhbmQgLi4uKSBvciAoLi4uIGFuZCAuLi4pIGxpa2UgaW4gdGhlIG9sZCB3YXkganVzdCBmb3IgTVNTUUwuXG4gKlxuICogRm9yIHNpbmdsZSBjb2x1bW4gcHJpbWFyeSBrZXk6XG4gKlxuICogMS4gaWYgb25seSAxIHJvdzogY29sID0gdmFsdWVcbiAqIDIuIGlmIG11bHRpcGxlIHJvd3M6IGNvbCBJTiAodmFsdWUxLCB2YWx1ZTIsIC4uLilcbiAqXG4gKiBGb3IgY29tcG9zaXRlIHByaW1hcnkga2V5OlxuICpcbiAqIDEuIGlmIG9ubHkgMSByb3c6IChjb2wxLCBjb2wyLCAuLi4pID0gKHZhbHVlMSwgdmFsdWUyLCAuLi4pXG4gKiAyLiBpZiBtdWx0aXBsZSByb3dzOiAoY29sMSwgY29sMiwgLi4uKSBJTiAoKHZhbHVlMWEsIHZhbHVlMmEsIC4uLiksICh2YWx1ZTFiLCB2YWx1ZTJiLCAuLi4pLCAuLi4pXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbmZlclJvd0ZpbHRlcnMocm93czogUmVjb3JkPHN0cmluZywgdW5rbm93bj5bXSwgY29sdW1uczogVGFibGVbXCJjb2x1bW5zXCJdKTogUm93RmlsdGVycyB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGNvbnN0IHJlZnM6IEV4cHJlc3Npb25XcmFwcGVyPGFueSwgYW55LCBhbnk+W10gPSBbXTtcbiAgY29uc3QgdmFsdWVzOiB1bmtub3duW10gPSBbXTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBjb25zdCBlYiA9IGV4cHJlc3Npb25CdWlsZGVyPGFueSwgYW55PigpO1xuXG4gIGZvciAoY29uc3Qgcm93IG9mIHJvd3MpIHtcbiAgICBjb25zdCB2YWx1ZXNGb3JSb3c6IHVua25vd25bXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBjb2x1bW4gb2YgT2JqZWN0LnZhbHVlcyhjb2x1bW5zKSkge1xuICAgICAgY29uc3QgeyBuYW1lOiBjb2x1bW5OYW1lLCBwa1Bvc2l0aW9uIH0gPSBjb2x1bW47XG5cbiAgICAgIGlmIChwa1Bvc2l0aW9uID09IG51bGwpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBrSW5kZXggPSBwa1Bvc2l0aW9uIC0gMTtcblxuICAgICAgaWYgKHJvdyA9PT0gcm93cy5hdCgwKSkge1xuICAgICAgICByZWZzW3BrSW5kZXhdID0gZWIucmVmKGNvbHVtbk5hbWUpO1xuICAgICAgfVxuXG4gICAgICB2YWx1ZXNGb3JSb3dbcGtJbmRleF0gPSB0cmFuc2Zvcm1WYWx1ZShyb3dbY29sdW1uTmFtZV0gPz8gbnVsbCwgY29sdW1uKTtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaChyZWZzLmxlbmd0aCA9PT0gMSA/IHZhbHVlc0ZvclJvdy5hdCgwKSEgOiB0dXBsZUZyb20odmFsdWVzRm9yUm93KSk7XG4gIH1cblxuICBjb25zdCBsaHMgPSByZWZzLmxlbmd0aCA9PT0gMSA/IHJlZnMuYXQoMCkhIDogdHVwbGVGcm9tKHJlZnMpO1xuICBjb25zdCByaHMgPSB2YWx1ZXMubGVuZ3RoID09PSAxID8gdmFsdWVzLmF0KDApISA6IHZhbHVlcztcblxuICByZXR1cm4gW1tbbGhzLCByaHNdXV07XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5mdW5jdGlvbiB0dXBsZUZyb20oaXRlbXM6IHVua25vd25bXSk6IEV4cHJlc3Npb248YW55PiB7XG4gIHJldHVybiBzcWxgKCR7c3FsLmpvaW4oaXRlbXMsIHNxbGAsIGApfSlgO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFwcGx5V3JpdGVUcmFuc2Zvcm1hdGlvbnNQcm9wczxDIGV4dGVuZHMgXCJpbnNlcnRcIiB8IFwidXBkYXRlXCI+IHtcbiAgY29sdW1uczogVGFibGVbXCJjb2x1bW5zXCJdO1xuICBjb250ZXh0OiBDO1xuICB2YWx1ZXM6IEMgZXh0ZW5kcyBcInVwZGF0ZVwiID8gUmVjb3JkPHN0cmluZywgdW5rbm93bj4gOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8IFJlY29yZDxzdHJpbmcsIHVua25vd24+W107XG4gIHN1cHBvcnRzRGVmYXVsdEtleXdvcmQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVRyYW5zZm9ybWF0aW9uczxDIGV4dGVuZHMgXCJpbnNlcnRcIiB8IFwidXBkYXRlXCI+KFxuICBwcm9wczogQXBwbHlXcml0ZVRyYW5zZm9ybWF0aW9uc1Byb3BzPEM+LFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuKTogQyBleHRlbmRzIFwidXBkYXRlXCIgPyAoKSA9PiBVcGRhdGVPYmplY3Q8YW55LCBhbnk+IDogKCkgPT4gSW5zZXJ0T2JqZWN0PGFueSwgYW55PiB8IEluc2VydE9iamVjdDxhbnksIGFueT5bXSB7XG4gIGNvbnN0IHsgdmFsdWVzIH0gPSBwcm9wcztcblxuICByZXR1cm4gKCkgPT5cbiAgICBBcnJheS5pc0FycmF5KHZhbHVlcylcbiAgICAgID8gdmFsdWVzLm1hcCgocm93KSA9PiB0cmFuc2Zvcm1WYWx1ZXMoeyAuLi5wcm9wcywgdmFsdWVzOiByb3cgfSkpXG4gICAgICA6IHRyYW5zZm9ybVZhbHVlcyh7IC4uLnByb3BzLCB2YWx1ZXMgfSk7XG59XG5cbmludGVyZmFjZSBUcmFuc2Zvcm1WYWx1ZXNQcm9wcyB7XG4gIGNvbHVtbnM6IFRhYmxlW1wiY29sdW1uc1wiXTtcbiAgY29udGV4dDogXCJpbnNlcnRcIiB8IFwidXBkYXRlXCI7XG4gIHN1cHBvcnRzRGVmYXVsdEtleXdvcmQ6IGJvb2xlYW47XG4gIHZhbHVlczogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG59XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybVZhbHVlcyhwcm9wczogVHJhbnNmb3JtVmFsdWVzUHJvcHMpOiBJbnNlcnRPYmplY3Q8dW5rbm93biwgbmV2ZXI+IHwgVXBkYXRlT2JqZWN0PHVua25vd24sIG5ldmVyPiB7XG4gIGNvbnN0IHsgY29sdW1ucywgY29udGV4dCwgc3VwcG9ydHNEZWZhdWx0S2V5d29yZCwgdmFsdWVzIH0gPSBwcm9wcztcblxuICBjb25zdCB2YWx1ZUVudHJpZXMgPSBPYmplY3QuZW50cmllcyh2YWx1ZXMpO1xuXG4gIGNvbnN0IHJlcXVpcmVkQ29sdW1ucyA9IGNvbnRleHQgPT09IFwidXBkYXRlXCIgPyBbXSA6IE9iamVjdC52YWx1ZXMoY29sdW1ucykuZmlsdGVyKChjb2wpID0+IGNvbC5pc1JlcXVpcmVkKTtcblxuICBpZiAoY29udGV4dCA9PT0gXCJpbnNlcnRcIiAmJiB2YWx1ZUVudHJpZXMubGVuZ3RoID09PSAwICYmIHJlcXVpcmVkQ29sdW1ucy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4geyBbT2JqZWN0LmtleXMoY29sdW1ucykuYXQoMCkhXTogc3VwcG9ydHNEZWZhdWx0S2V5d29yZCA/IHNxbGBkZWZhdWx0YCA6IG51bGwgfTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZUVudHJpZXMucmVkdWNlKFxuICAgIChvYmosIFtrZXksIHZhbHVlXSkgPT4gKHsgLi4ub2JqLCBba2V5XTogdHJhbnNmb3JtVmFsdWUodmFsdWUsIGNvbHVtbnNba2V5XSEsIHN1cHBvcnRzRGVmYXVsdEtleXdvcmQpIH0pLFxuICAgIHJlcXVpcmVkQ29sdW1ucy5yZWR1Y2UoKGRlZmF1bHRzLCBjb2x1bW4pID0+IHtcbiAgICAgIGNvbnN0IHsgZGF0YXR5cGUsIGZrQ29sdW1uLCBuYW1lIH0gPSBjb2x1bW47XG4gICAgICBjb25zdCB7IGZvcm1hdCwgZ3JvdXAsIGlzQXJyYXkgfSA9IGRhdGF0eXBlO1xuXG4gICAgICAvLyBkbyBub3QgYXR0ZW1wdCB0byBzZXQgYSBkZWZhdWx0IHZhbHVlIGZvciBmb3JlaWduIGtleXMsIGFzIGl0J2xsIHByb2JhYmx5XG4gICAgICAvLyBmYWlsIGR1ZSB0byByZWZlcmVudGlhbCBpbnRlZ3JpdHkgY2hlY2tzIVxuICAgICAgaWYgKGZrQ29sdW1uKSB7XG4gICAgICAgIHJldHVybiBkZWZhdWx0cztcbiAgICAgIH1cblxuICAgICAgaWYgKGlzQXJyYXkgfHwgZ3JvdXAgPT09IFwianNvblwiKSB7XG4gICAgICAgIHJldHVybiB7IC4uLmRlZmF1bHRzLCBbbmFtZV06IERFRkFVTFRfSlNPTiB9O1xuICAgICAgfVxuXG4gICAgICBpZiAoZ3JvdXAgPT09IFwiYm9vbGVhblwiKSB7XG4gICAgICAgIHJldHVybiB7IC4uLmRlZmF1bHRzLCBbbmFtZV06IERFRkFVTFRfQk9PTEVBTiB9O1xuICAgICAgfVxuXG4gICAgICBpZiAoZ3JvdXAgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIHsgLi4uZGVmYXVsdHMsIFtuYW1lXTogREVGQVVMVF9TVFJJTkcgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKGdyb3VwID09PSBcIm51bWVyaWNcIikge1xuICAgICAgICByZXR1cm4geyAuLi5kZWZhdWx0cywgW25hbWVdOiBERUZBVUxUX05VTUVSSUMgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKChncm91cCA9PT0gXCJkYXRldGltZVwiIHx8IGdyb3VwID09PSBcInRpbWVcIikgJiYgZm9ybWF0KSB7XG4gICAgICAgIHJldHVybiB7IC4uLmRlZmF1bHRzLCBbbmFtZV06IGdldERhdGUwKGZvcm1hdCkgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRlZmF1bHRzO1xuICAgIH0sIHt9KSBhcyBJbnNlcnRPYmplY3Q8dW5rbm93biwgbmV2ZXI+IHwgVXBkYXRlT2JqZWN0PHVua25vd24sIG5ldmVyPixcbiAgKTtcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmZ1bmN0aW9uIHRyYW5zZm9ybVZhbHVlKHZhbHVlOiB1bmtub3duLCBjb2x1bW46IENvbHVtbiwgc3VwcG9ydHNEZWZhdWx0S2V5d29yZCA9IHRydWUpOiBFeHByZXNzaW9uPGFueT4ge1xuICBjb25zdCB7IGRhdGF0eXBlLCBkZWZhdWx0VmFsdWUsIG51bGxhYmxlIH0gPSBjb2x1bW47XG5cbiAgY29uc3QgZWIgPSBleHByZXNzaW9uQnVpbGRlcigpO1xuXG4gIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCAodmFsdWUgPT09IFwiXCIgJiYgbnVsbGFibGUpKSB7XG4gICAgcmV0dXJuIGViLmxpdChudWxsKTtcbiAgfVxuXG4gIGlmICgodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkgJiYgZGVmYXVsdFZhbHVlICE9IG51bGwpIHtcbiAgICByZXR1cm4gc3VwcG9ydHNEZWZhdWx0S2V5d29yZCA/IHNxbGBkZWZhdWx0YCA6IGViLmxpdChudWxsKTtcbiAgfVxuXG4gIGlmICghZGF0YXR5cGUuaXNOYXRpdmUpIHtcbiAgICByZXR1cm4gZWIuY2FzdChlYi52YWwodmFsdWUpLCBzcWwuaWQoZGF0YXR5cGUuc2NoZW1hLCBkYXRhdHlwZS5uYW1lKSk7XG4gIH1cblxuICByZXR1cm4gZWIudmFsKHZhbHVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlbGVjdEZpbHRlckV4cHJlc3Npb24oXG4gIGZpbHRlcnM6IChDb2x1bW5GaWx0ZXIgfCBGaWx0ZXJHcm91cClbXSxcbiAgY29sdW1uczogVGFibGVbXCJjb2x1bW5zXCJdLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuKTogKGViOiBFeHByZXNzaW9uQnVpbGRlcjxhbnksIGFueT4pID0+IEV4cHJlc3Npb248U3FsQm9vbD4ge1xuICBpZiAoZmlsdGVycy5sZW5ndGggPT09IDApIHJldHVybiAoZWIpID0+IGViLmxpdCh0cnVlKTsgLy8gbm8gZmlsdGVycywgYWx3YXlzIHRydWVcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBjb25zdCBvckdyb3Vwc09mQW5kQnVpbGRlcnM6ICgoZWI6IEV4cHJlc3Npb25CdWlsZGVyPGFueSwgYW55PikgPT4gRXhwcmVzc2lvbjxTcWxCb29sPilbXVtdID0gW107XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGxldCBjdXJyZW50QW5kR3JvdXBCdWlsZGVyczogKChlYjogRXhwcmVzc2lvbkJ1aWxkZXI8YW55LCBhbnk+KSA9PiBFeHByZXNzaW9uPFNxbEJvb2w+KVtdID0gW107XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgY3VycmVudEFuZEdyb3VwQnVpbGRlcnMucHVzaChidWlsZEJhc2VFeHByZXNzaW9uQnVpbGRlcihmaWx0ZXJzW2ldISwgY29sdW1ucykpO1xuXG4gICAgLy8gJm4gQU5EIGdyb3VwIGVuZHMgaWYgaXQncyB0aGUgbGFzdCBmaWx0ZXIsIG9yIHRoZSBpdGVtIGlzIGZvbGxvd2VkIGJ5IGFuICdvcidcbiAgICBpZiAoaSA9PT0gZmlsdGVycy5sZW5ndGggLSAxIHx8IGZpbHRlcnNbaV0hLmFmdGVyID09PSBcIm9yXCIpIHtcbiAgICAgIG9yR3JvdXBzT2ZBbmRCdWlsZGVycy5wdXNoKGN1cnJlbnRBbmRHcm91cEJ1aWxkZXJzKTtcbiAgICAgIGN1cnJlbnRBbmRHcm91cEJ1aWxkZXJzID0gW107IC8vIHN0YXJ0IGEgbmV3IGdyb3VwXG4gICAgfVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcmV0dXJuIChlYjogRXhwcmVzc2lvbkJ1aWxkZXI8YW55LCBhbnk+KSA9PiB7XG4gICAgY29uc3QgYW5kRXhwcmVzc2lvbnMgPSBvckdyb3Vwc09mQW5kQnVpbGRlcnMubWFwKChncm91cCkgPT4ge1xuICAgICAgcmV0dXJuIGViLmFuZChncm91cC5tYXAoKGJ1aWxkZXIpID0+IGJ1aWxkZXIoZWIpKSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZWIub3IoYW5kRXhwcmVzc2lvbnMpO1xuICB9O1xufVxuXG4vLyBIZWxwZXIgdG8gYnVpbGQgYW4gZXhwcmVzc2lvbiBidWlsZGVyIGZvciBhIHNpbmdsZSBmaWx0ZXIgb3IgYSBncm91cFxuZnVuY3Rpb24gYnVpbGRCYXNlRXhwcmVzc2lvbkJ1aWxkZXIoXG4gIHNwZWM6IENvbHVtbkZpbHRlciB8IEZpbHRlckdyb3VwLFxuICBjb2x1bW5zOiBUYWJsZVtcImNvbHVtbnNcIl0sXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4pOiAoZWI6IEV4cHJlc3Npb25CdWlsZGVyPGFueSwgYW55PikgPT4gRXhwcmVzc2lvbjxTcWxCb29sPiB7XG4gIGlmIChzcGVjLmtpbmQgPT09IFwiQ29sdW1uRmlsdGVyXCIpIHtcbiAgICByZXR1cm4gKGViKSA9PiB7XG4gICAgICBjb25zdCB7IGNvbHVtbiwgb3BlcmF0b3IsIHZhbHVlIH0gPSBzcGVjO1xuXG4gICAgICBjb25zdCBjb2x1bW5NZXRhID0gY29sdW1uc1tjb2x1bW5dITtcblxuICAgICAgcmV0dXJuIGViKFxuICAgICAgICBjb2x1bW5NZXRhLmRhdGF0eXBlLmdyb3VwID09PSBcInJhd1wiID8gZWIuY2FzdChjb2x1bW4sIFwidGV4dFwiKSA6IGNvbHVtbixcbiAgICAgICAgb3BlcmF0b3IsXG4gICAgICAgIHRyYW5zZm9ybVZhbHVlKHZhbHVlLCBjb2x1bW5NZXRhKSxcbiAgICAgICk7XG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiBnZXRTZWxlY3RGaWx0ZXJFeHByZXNzaW9uKHNwZWMuZmlsdGVycywgY29sdW1ucyk7XG59XG4iXSwKICAibWFwcGluZ3MiOiAiNGNBQUEsSUFBQUEsRUFBQUMsRUFBQSxRQ0FBLElBQUFDLEVBQUEsR0FBQUMsRUFBQUQsRUFBQSw4QkFBQUUsSUFBQSxlQUFBQyxFQUFBSCxHQUFBSSxJQ0FBQyxJQWtCTyxJQUFNQyxFQUFOLGNBQXlCLEtBQU0sQ0FDcEMsYUFBYyxDQUNaLE1BQU0sNEJBQTRCLEVBQ2xDLEtBQUssS0FBTyxZQUNkLENBQ0YsRUFFTyxTQUFTQyxHQUErQixDQUM3QyxNQUFPLENBQUMsSUFBSUQsQ0FBWSxDQUMxQixDQzNCQUUsSUNBQUMsSUFtRk8sU0FBU0MsRUFBV0MsRUFBMEMsQ0FDbkUsT0FBSSxPQUFPQSxHQUFVLFNBQ1osQ0FBRSxXQUFZLENBQUMsRUFBRyxJQUFLQSxDQUFNLEVBRy9CQSxDQUNULENEdkZPLFNBQVNDLEdBQXVDLENBQ3JELE9BQU9DLEVBQVEsZ0NBQWdDLENBQ2pELENBR08sU0FBU0MsRUFBZUMsRUFBeUIsQ0FDdEQsTUFBTyxDQUNMLFdBQVksQ0FBQ0EsQ0FBRyxFQUNoQixJQUFLLCtCQUNQLENBQ0YsQ0ZOTyxTQUFTQyxFQUF5QkMsRUFBMkIsQ0FDbEUsTUFBTyxDQUNMLFFBQVMsTUFBT0MsRUFBT0MsSUFBWSxDQUNqQyxHQUFNLENBQUUsWUFBQUMsQ0FBWSxFQUFJRCxHQUFXLENBQUMsRUFFcEMsR0FBSSxDQUFDQyxFQUNILEdBQUksQ0FHRixNQUFPLENBQUMsS0FGTyxNQUFNSCxFQUFXLE9BQU9DLEVBQU0sSUFBS0EsRUFBTSxVQUFtQixDQUU5QyxDQUMvQixPQUFTRyxFQUFnQixDQUN2QixNQUFPLENBQUNBLENBQWMsQ0FDeEIsQ0FHRixHQUFJRCxFQUFZLFFBQ2QsT0FBT0UsRUFBZSxFQUd4QixJQUFJQyxFQUNBQyxFQUVKLEdBQUksQ0FDRixJQUFJQyxFQUNFQyxFQUFrQixJQUFJLFFBQWVDLEdBQWFGLEVBQVVFLENBQVEsRUFFMUVQLEVBQVksaUJBQWlCLFFBQVVHLEVBQWdCLElBQU1FLEVBQVEsQ0FBRSxFQUV2RSxJQUFNRyxFQUFvQlgsRUFBVyxRQUFRLEVBRXZDWSxFQUFtQixNQUFNLFFBQVEsS0FBSyxDQUFDRCxFQUFtQkYsQ0FBZSxDQUFDLEVBRWhGLEdBQUksQ0FBQ0csRUFDSCxPQUFLRCxFQUFrQixNQUFNLElBQU0sQ0FBQyxDQUFDLEVBRTlCTixFQUFlLEVBS3hCLEdBRkFFLEVBQWFLLEVBRVRULEVBQVksUUFDZCxPQUFBSSxFQUFXLFFBQVEsRUFFWkYsRUFBZSxFQUd4QixJQUFNUSxFQUFhQyxFQUFpQlAsQ0FBVSxFQUV4Q1EsRUFBWSxNQUFNLFFBQVEsS0FBSyxDQUFDRixFQUFZSixDQUFlLENBQUMsRUFFbEUsR0FBSU0sSUFBYyxPQUNoQixPQUFLRixFQUFXLE1BQU0sSUFBTSxDQUFDLENBQUMsRUFBRSxRQUFRLElBQU1OLEdBQVksUUFBUSxDQUFDLEVBRTVERixFQUFlLEVBR3hCLEdBQUlGLEVBQVksUUFDZCxPQUFBSSxFQUFXLFFBQVEsRUFFWkYsRUFBZSxFQUd4QixJQUFNVyxFQUFlVCxFQUFXLE9BQU9OLEVBQU0sSUFBS0EsRUFBTSxVQUFtQixFQUVyRWdCLEVBQWMsTUFBTSxRQUFRLEtBQUssQ0FBQ0QsRUFBY1AsQ0FBZSxDQUFDLEVBRXRFLE9BQUtRLEdBUUxWLEVBQVcsUUFBUSxFQUVaLENBQUMsS0FBTVUsQ0FBb0IsSUFUM0IsUUFBUSxXQUFXLENBQUNDLEVBQVlsQixFQUFZZSxDQUFVLEVBQUdDLENBQVksQ0FBQyxFQUFFLFFBQVEsSUFDbkZULEdBQVksUUFBUSxDQUN0QixFQUVPRixFQUFlLEVBTTFCLE9BQVNELEVBQWdCLENBQ3ZCLE9BQUFHLEdBQVksUUFBUSxFQUViLENBQUNILENBQWMsQ0FDeEIsUUFBRSxDQUNJRSxHQUNGSCxHQUFhLG9CQUFvQixRQUFTRyxDQUFhLENBRTNELENBQ0YsQ0FDRixDQUNGLENBR0EsZUFBZVksRUFBWWxCLEVBQWlCbUIsRUFBd0IsQ0FDbEUsSUFBTWxCLEVBQVFtQixFQUFlRCxDQUFHLEVBRWhDLEdBQUksQ0FDRixNQUFNbkIsRUFBVyxPQUFPQyxFQUFNLElBQUtBLEVBQU0sVUFBbUIsQ0FDOUQsT0FBU0csRUFBTyxDQUNkLFFBQVEsTUFBTSwwQkFBMkJBLENBQUssQ0FDaEQsQ0FDRixDQUVBLGVBQWVVLEVBQWlCUCxFQUEyQyxDQUN6RSxJQUFNTixFQUFRb0IsRUFBWSxFQUUxQixHQUFJLENBQ0YsR0FBTSxDQUFDQyxDQUFNLEVBQUksTUFBTWYsRUFBVyxPQUFrQ04sRUFBTSxJQUFLQSxFQUFNLFVBQW1CLEVBRXhHLE9BQU9xQixHQUFRLEdBQ2pCLE9BQVNsQixFQUFPLENBQ2QsUUFBUSxNQUFNLGdDQUFpQ0EsQ0FBSyxFQUVwRCxNQUNGLENBQ0YiLAogICJuYW1lcyI6IFsiaW5pdF9kZWZpbmVfQUNDRUxFUkFURV9TQ0hFTUFfQllfUFJPVklERVIiLCAiX19lc21NaW4iLCAicG9zdGdyZXNqc19leHBvcnRzIiwgIl9fZXhwb3J0IiwgImNyZWF0ZVBvc3RncmVzSlNFeGVjdXRvciIsICJfX3RvQ29tbW9uSlMiLCAiaW5pdF9kZWZpbmVfQUNDRUxFUkFURV9TQ0hFTUFfQllfUFJPVklERVIiLCAiaW5pdF9kZWZpbmVfQUNDRUxFUkFURV9TQ0hFTUFfQllfUFJPVklERVIiLCAiQWJvcnRFcnJvciIsICJnZXRBYm9ydFJlc3VsdCIsICJpbml0X2RlZmluZV9BQ0NFTEVSQVRFX1NDSEVNQV9CWV9QUk9WSURFUiIsICJpbml0X2RlZmluZV9BQ0NFTEVSQVRFX1NDSEVNQV9CWV9QUk9WSURFUiIsICJhc1F1ZXJ5IiwgInF1ZXJ5IiwgImdldFBJRFF1ZXJ5IiwgImFzUXVlcnkiLCAiZ2V0Q2FuY2VsUXVlcnkiLCAicGlkIiwgImNyZWF0ZVBvc3RncmVzSlNFeGVjdXRvciIsICJwb3N0Z3Jlc2pzIiwgInF1ZXJ5IiwgIm9wdGlvbnMiLCAiYWJvcnRTaWduYWwiLCAiZXJyb3IiLCAiZ2V0QWJvcnRSZXN1bHQiLCAiYWJvcnRMaXN0ZW5lciIsICJjb25uZWN0aW9uIiwgImFib3J0ZWQiLCAiYWJvcnRpb25Qcm9taXNlIiwgInJlc29sdmUiLCAiY29ubmVjdGlvblByb21pc2UiLCAiY29ubmVjdGlvblJlc3VsdCIsICJwaWRQcm9taXNlIiwgImdldENvbm5lY3Rpb25QSUQiLCAicGlkUmVzdWx0IiwgInF1ZXJ5UHJvbWlzZSIsICJxdWVyeVJlc3VsdCIsICJjYW5jZWxRdWVyeSIsICJwaWQiLCAiZ2V0Q2FuY2VsUXVlcnkiLCAiZ2V0UElEUXVlcnkiLCAicmVzdWx0Il0KfQo=